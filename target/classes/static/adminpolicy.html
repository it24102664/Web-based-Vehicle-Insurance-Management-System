<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - MotorCare LK</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }
        /* Header Styles - Updated with Dashboard and Logout */
        .header {
            background: #fff;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #4a69bd;
        }
        .logo::before {
            content: "üõ°Ô∏è";
            margin-right: 0.5rem;
            color: #ff6b35;
        }
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
        }
        .nav-menu a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
            cursor: pointer;
        }
        .nav-menu a:hover, .nav-menu a.active {
            color: #4a69bd;
        }
        .auth-buttons {
            display: flex;
            gap: 1rem;
        }
        .btn {
            padding: 0.6rem 1.2rem;
            border: 2px solid;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-dashboard {
            background: white;
            color: #4a69bd;
            border-color: #4a69bd;
        }
        .btn-dashboard:hover {
            background: #4a69bd;
            color: white;
        }
        .btn-logout {
            background: #ff6b35;
            color: white;
            border-color: #ff6b35;
        }
        .btn-logout:hover {
            background: #e55a2b;
            border-color: #e55a2b;
        }
        .btn-success {
            background: #28a745;
            color: white;

        }
        .btn-success:hover {
            background: #218838;
        }
        .btn-warning {
            background: #ffc107;
            color: #212529;
            border: none;
        }
        .btn-warning:hover {
            background: #e0a800;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
            border: none;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        /* Layout Styles */
        .policy-layout {
            display: flex;
            min-height: calc(100vh - 80px);
            margin-top: 80px;
        }
        /* Sidebar Styles */
        .policy-sidebar {
            width: 280px;
            background: linear-gradient(135deg, #4a69bd, #1e3799);
            color: white;
            position: fixed;
            height: calc(100vh - 80px);
            overflow-y: auto;
            z-index: 100;
        }
        .sidebar-header {
            padding: 2rem 1.5rem;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .sidebar-header h3 {
            color: #ff6b35;
            margin-bottom: 0.5rem;
        }
        .sidebar-nav {
            padding: 1rem 0;
        }
        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 1rem;
            position: relative;
        }
        .sidebar-item:hover, .sidebar-item.active {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left: 4px solid #ff6b35;
        }
        /* Content Area */
        .policy-content {
            margin-left: 280px;
            padding: 2rem;
            flex: 1;
            background: #f8f9fa;
        }
        /* Page Styles */
        .policy-section {
            display: none;
        }
        .policy-section.active {
            display: block;
        }
        /* Policy Cards Grid */
        .policies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        .policy-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }
        .policy-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }
        .policy-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #4a69bd, #1e3799);
        }
        .policy-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .policy-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #4a69bd, #1e3799);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin-right: 1rem;
        }
        .policy-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #4a69bd;
            margin: 0;
        }
        .policy-description {
            color: #666;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        .policy-benefits {
            margin-bottom: 2rem;
        }
        .policy-benefits h4 {
            color: #4a69bd;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        .policy-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }
        .modal-header h2 {
            color: #4a69bd;
            margin: 0;
            font-size: 1.5rem;
        }
        .close {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #666;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .close:hover {
            background: #f0f0f0;
            color: #333;
        }
        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #4a69bd;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: inherit;
            background: #f8f9fa;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #4a69bd;
            background: white;
            box-shadow: 0 0 0 3px rgba(74, 105, 189, 0.1);
        }
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        .input-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #4a69bd;
            font-size: 1.1rem;
            z-index: 1;
        }
        .form-group.has-textarea .input-icon {
            top: 3rem;
            transform: none;
        }
        .btn-submit {
            background: linear-gradient(135deg, #4a69bd, #1e3799);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            font-size: 1.1rem;
        }
        .btn-submit:hover {
            background: linear-gradient(135deg, #3c5aa6, #1a2e7a);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(74, 105, 189, 0.3);
        }
        /* Alert Styles */
        .alert {
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            display: none;
            align-items: center;
            gap: 0.5rem;
        }
        .alert.show {
            display: flex;
        }
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #f59e0b;
        }
        /* Admin Styles */
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #4a69bd, #1e3799);
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #4a69bd;
            margin-bottom: 0.5rem;
        }
        .stat-label {
            color: #666;
            font-weight: 500;
        }
        /* Table Styles */
        .table-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-top: 2rem;
        }
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #4a69bd;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        .status-approved {
            background: #d1fae5;
            color: #065f46;
        }
        .status-rejected {
            background: #fee2e2;
            color: #991b1b;
        }
        .status-duplicate {
            background: #fef3c7;
            color: #92400e;
        }
        .duplicate-indicator {
            width: 12px;
            height: 12px;
            background: #dc3545;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        /* Create Policy Form */
        .create-policy-form {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-top: 2rem;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        .form-row .form-group {
            margin-bottom: 1rem;
        }
        /* Notification Bell */
        .notification-bell {
            color: #ff6b35;
            font-size: 1rem;
            margin-left: 0.5rem;
            position: relative;
            display: inline-block;
        }
        .notification-bell.active {
            animation: ring 1.5s ease-in-out infinite;
        }
        .notification-bell:hover::after {
            content: attr(data-count);
            position: absolute;
            top: -20px;
            right: -10px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        @keyframes ring {
            0% { transform: rotate(0deg); }
            10% { transform: rotate(15deg); }
            20% { transform: rotate(-15deg); }
            30% { transform: rotate(10deg); }
            40% { transform: rotate(-10deg); }
            50% { transform: rotate(0deg); }
            100% { transform: rotate(0deg); }
        }
        /* Responsive Design */
        @media (max-width: 768px) {
            .policy-layout {
                flex-direction: column;
            }
            .policy-sidebar {
                width: 100%;
                position: relative;
                height: auto;
            }
            .policy-content {
                margin-left: 0;
                padding: 1rem;
            }
            .policies-grid {
                grid-template-columns: 1fr;
            }
            .modal-content {
                margin: 1rem;
                width: calc(100% - 2rem);
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .admin-stats {
                grid-template-columns: 1fr;
            }
            .auth-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
            .btn {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
<!-- Header -->
<header class="header">
    <div class="nav-container">
        <div class="logo">MOTORCARE LK</div>
        <nav class="nav-menu">
            <a href="#" class="nav-link active">POLICY</a>
            <a href="#" class="nav-link">SERVICES</a>
            <a href="#" class="nav-link">CONTACT</a>
        </nav>
        <!-- Dashboard and Logout Buttons -->
        <div class="auth-buttons">
            <button class="btn btn-dashboard" onclick="showAdminDashboard()">
                üìä Dashboard
            </button>
            <button class="btn btn-logout" onclick="handleLogout()">
                üö™ Logout
            </button>
        </div>
    </div>
</header>

<!-- Policy Management Layout -->
<div class="policy-layout">
    <!-- Sidebar -->
    <div class="policy-sidebar">
        <div class="sidebar-header">
            <h3 id="sidebarTitle">üõ°Ô∏è Admin Panel</h3>
            <p id="sidebarSubtitle">Policy Management</p>
        </div>
        <nav class="sidebar-nav" id="adminNavigation">
            <button class="sidebar-item active" onclick="showPolicySection('admin-overview')"> üìä Overview </button>
            <button class="sidebar-item" onclick="showPolicySection('manage-policies')"> üìÑ Manage Policies </button>
            <button class="sidebar-item" onclick="showPolicySection('policy-applications')"> üìã Applications <span class="notification-bell" id="applicationsBadge" data-count="0">üîî</span> </button>
            <button class="sidebar-item" onclick="showPolicySection('create-policy')"> ‚ûï Create Policy </button>
        </nav>
    </div>

    <!-- Content Area -->
    <div class="policy-content">
        <div id="alertContainer" class="alert"></div>

        <!-- ADMIN SECTIONS -->
        <!-- Admin Overview Section -->
        <div id="admin-overview" class="policy-section active">
            <div class="admin-header">
                <div>
                    <h2 style="color: #4a69bd; margin-bottom: 0.5rem;">üìä Policy Management Overview</h2>
                    <p style="color: #666;">Monitor policy performance and application statistics</p>
                </div>
            </div>
            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalPolicies">0</div>
                    <div class="stat-label">Active Policies</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pendingApplications">0</div>
                    <div class="stat-label">Pending Applications</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="approvedApplications">0</div>
                    <div class="stat-label">Approved Applications</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="duplicateApplications">0</div>
                    <div class="stat-label">Duplicate Applications</div>
                </div>
            </div>
            <div class="table-container">
                <div class="table-header">
                    <h3 style="color: #4a69bd; margin: 0;">Recent Activities</h3>
                </div>
                <table>
                    <thead>
                    <tr>
                        <th>Activity</th>
                        <th>Policy</th>
                        <th>User</th>
                        <th>Date</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody id="recentActivities">
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Manage Policies Section -->
        <div id="manage-policies" class="policy-section">
            <div class="admin-header">
                <div>
                    <h2 style="color: #4a69bd; margin-bottom: 0.5rem;">üìÑ Manage Policies</h2>
                    <p style="color: #666;">Update, edit, and manage existing insurance policies</p>
                </div>
                <button class="btn btn-success" onclick="showPolicySection('create-policy')"> ‚ûï Add New Policy </button>
            </div>
            <div class="policies-grid" id="adminPoliciesGrid">
            </div>
        </div>
        <!-- Policy Applications Section -->
        <div id="policy-applications" class="policy-section">
            <div class="admin-header">
                <div>
                    <h2 style="color: #4a69bd; margin-bottom: 0.5rem;">üìã Policy Applications</h2>
                    <p style="color: #666;">Review and manage user policy applications</p>
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-success" onclick="approveSelected()">‚úÖ Approve Selected</button>
                    <button class="btn btn-danger" onclick="rejectSelected()">‚ùå Reject Selected</button>
                </div>
            </div>
            <div class="table-container">
                <div class="table-header">
                    <h3 style="color: #4a69bd; margin: 0;">Applications Management</h3>
                    <button class="btn btn-success" onclick="refreshApplications()">üîÑ Refresh</button>
                </div>
                <table id="adminApplicationsTable">
                    <thead>
                    <tr>
                        <th><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>
                        <th>ID</th>
                        <th>Applicant</th>
                        <th>Policy</th>
                        <th>Vehicle</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="applicationsTableBody">
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Create Policy Section -->
        <div id="create-policy" class="policy-section">
            <div class="admin-header">
                <div>
                    <h2 style="color: #4a69bd; margin-bottom: 0.5rem;">‚ûï Create New Policy</h2>
                    <p style="color: #666;">Add a new insurance policy to the platform</p>
                </div>
            </div>
            <div class="create-policy-form">
                <form id="createPolicyForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="policyName">üìã Policy Name</label>
                            <div class="input-icon">üìã</div>
                            <input type="text" id="policyName" required placeholder="Enter policy name">
                        </div>
                        <div class="form-group">
                            <label for="policyIcon">üé® Policy Icon</label>
                            <div class="input-icon">üé®</div>
                            <select id="policyIcon" required>
                                <option value="">Select an icon</option>
                                <option value="üõ∫">üõ∫ Tuk Tuk</option>
                                <option value="üöó">üöó Car</option>
                                <option value="üèçÔ∏è">üèçÔ∏è Motorcycle</option>
                                <option value="üöõ">üöõ Commercial</option>
                                <option value="üöê">üöê Van</option>
                                <option value="üöå">üöå Bus</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group has-textarea">
                        <label for="policyDescription">üìù Policy Description</label>
                        <div class="input-icon">üìù</div>
                        <textarea id="policyDescription" required placeholder="Enter detailed policy description"></textarea>
                    </div>
                    <div class="form-group has-textarea">
                        <label for="policyBenefits">‚úÖ Key Benefits (one per line)</label>
                        <div class="input-icon">‚úÖ</div>
                        <textarea id="policyBenefits" required placeholder="Enter benefits (one per line)&#10;Example:&#10;Third-party liability coverage&#10;Vehicle damage protection&#10;Personal accident coverage"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="premiumAmount">üí∞ Premium Amount (‚Ç®)</label>
                            <div class="input-icon">üí∞</div>
                            <input type="number" id="premiumAmount" required placeholder="Enter premium amount">
                        </div>
                        <div class="form-group">
                            <label for="coverageAmount">üõ°Ô∏è Coverage Amount (‚Ç®)</label>
                            <div class="input-icon">üõ°Ô∏è</div>
                            <input type="number" id="coverageAmount" required placeholder="Enter coverage amount">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="policyType">üöó Vehicle Type</label>
                            <div class="input-icon">üöó</div>
                            <select id="policyType" required>
                                <option value="">Select vehicle type</option>
                                <option value="Three Wheeler">Three Wheeler</option>
                                <option value="Car">Car</option>
                                <option value="Motorcycle">Motorcycle</option>
                                <option value="Commercial">Commercial Vehicle</option>
                                <option value="Van">Van</option>
                                <option value="Bus">Bus</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="policyStatus">üìä Policy Status</label>
                            <div class="input-icon">üìä</div>
                            <select id="policyStatus" required>
                                <option value="ACTIVE">Active</option>
                                <option value="INACTIVE">Inactive</option>
                                <option value="DRAFT">Draft</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn-submit"> üöÄ Create Policy </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- View Application Details Modal -->
<div id="viewApplicationModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üëÅÔ∏è Application Details</h2>
            <button class="close" onclick="closeModal('viewApplicationModal')">&times;</button>
        </div>
        <div id="applicationDetailsContent">
        </div>
    </div>
</div>

<!-- Edit Policy Modal -->
<div id="editPolicyModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>‚úèÔ∏è Edit Policy</h2>
            <button class="close" onclick="closeModal('editPolicyModal')">&times;</button>
        </div>
        <form id="editPolicyForm">
            <input type="hidden" id="editPolicyId">
            <div class="form-row">
                <div class="form-group">
                    <label for="editPolicyName">üìã Policy Name</label>
                    <div class="input-icon">üìã</div>
                    <input type="text" id="editPolicyName" required placeholder="Enter policy name">
                </div>
                <div class="form-group">
                    <label for="editPolicyIcon">üé® Policy Icon</label>
                    <div class="input-icon">üé®</div>
                    <select id="editPolicyIcon" required>
                        <option value="">Select an icon</option>
                        <option value="üõ∫">üõ∫ Tuk Tuk</option>
                        <option value="üöó">üöó Car</option>
                        <option value="üèçÔ∏è">üèçÔ∏è Motorcycle</option>
                        <option value="üöõ">üöõ Commercial</option>
                        <option value="üöê">üöê Van</option>
                        <option value="üöå">üöå Bus</option>
                    </select>
                </div>
            </div>
            <div class="form-group has-textarea">
                <label for="editPolicyDescription">üìù Policy Description</label>
                <div class="input-icon">üìù</div>
                <textarea id="editPolicyDescription" required placeholder="Enter detailed policy description"></textarea>
            </div>
            <div class="form-group has-textarea">
                <label for="editPolicyBenefits">‚úÖ Key Benefits (one per line)</label>
                <div class="input-icon">‚úÖ</div>
                <textarea id="editPolicyBenefits" required placeholder="Enter benefits (one per line)"></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="editPremiumAmount">üí∞ Premium Amount (‚Ç®)</label>
                    <div class="input-icon">üí∞</div>
                    <input type="number" id="editPremiumAmount" required placeholder="Enter premium amount">
                </div>
                <div class="form-group">
                    <label for="editCoverageAmount">üõ°Ô∏è Coverage Amount (‚Ç®)</label>
                    <div class="input-icon">üõ°Ô∏è</div>
                    <input type="number" id="editCoverageAmount" required placeholder="Enter coverage amount">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="editPolicyType">üöó Vehicle Type</label>
                    <div class="input-icon">üöó</div>
                    <select id="editPolicyType" required>
                        <option value="">Select vehicle type</option>
                        <option value="Three Wheeler">Three Wheeler</option>
                        <option value="Car">Car</option>
                        <option value="Motorcycle">Motorcycle</option>
                        <option value="Commercial">Commercial Vehicle</option>
                        <option value="Van">Van</option>
                        <option value="Bus">Bus</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editPolicyStatus">üìä Policy Status</label>
                    <div class="input-icon">üìä</div>
                    <select id="editPolicyStatus" required>
                        <option value="ACTIVE">Active</option>
                        <option value="INACTIVE">Inactive</option>
                        <option value="DRAFT">Draft</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="btn-submit"> üíæ Save Changes </button>
        </form>
    </div>
</div>

<script>
    // API Base URL - CORRECTED TO MATCH YOUR CONTROLLERS
    const API_BASE_URL = 'http://localhost:8080/api';

    // Initialize application
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üõ°Ô∏è Admin Panel initialized with corrected API paths');
        initializeView();
    });

    // Initialize view
    async function initializeView() {
        showAdminView();
        await loadOverviewData();
        showPolicySection('admin-overview');
    }

    // Show admin view
    function showAdminView() {
        document.getElementById('sidebarTitle').textContent = 'üõ°Ô∏è Admin Panel';
        document.getElementById('sidebarSubtitle').textContent = 'Policy Management';
        document.getElementById('adminNavigation').style.display = 'block';
        updateNotificationBadge();
    }

    // Show policy section
    function showPolicySection(sectionId, event) {
        const sections = document.querySelectorAll('.policy-section');
        sections.forEach(section => section.classList.remove('active'));
        const targetSection = document.getElementById(sectionId);
        if (targetSection) {
            targetSection.classList.add('active');
        }
        if (event) {
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            sidebarItems.forEach(item => item.classList.remove('active'));
            const activeItem = event.target.closest('.sidebar-item');
            if (activeItem) {
                activeItem.classList.add('active');
            }
        }
        // Load data for specific sections
        if (sectionId === 'manage-policies') {
            loadPolicies();
        } else if (sectionId === 'policy-applications') {
            loadApplications();
        }
    }

    // ============ HEADER BUTTON FUNCTIONS ============
    function showAdminDashboard() {
        showPolicySection('admin-overview');
        showAlert('üìä Admin Dashboard loaded', 'success');
    }

    function handleLogout() {
        if (confirm('Are you sure you want to logout?')) {
            showAlert('üö™ Logging out... Goodbye!', 'success');
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1500);
        }
    }

    // ============ API FUNCTIONS - ALL FIXED ============

    // Show alert message
    function showAlert(message, type) {
        const alertContainer = document.getElementById('alertContainer');
        alertContainer.textContent = message;
        alertContainer.className = `alert alert-${type} show`;
        setTimeout(() => {
            alertContainer.classList.remove('show');
        }, 5000);
    }

    // Load overview data (stats and recent activities) - CORRECTED API PATHS
    async function loadOverviewData() {
        try {
            showAlert('Loading overview data...', 'success');

            // Fetch policies using your AdminPolicyController
            const policiesResponse = await fetch(`${API_BASE_URL}/admin-policies`);
            if (policiesResponse.ok) {
                const policies = await policiesResponse.json();
                document.getElementById('totalPolicies').textContent = policies.length;
            } else {
                document.getElementById('totalPolicies').textContent = '0';
            }

            // Fetch applications stats
            try {
                const applicationsResponse = await fetch(`${API_BASE_URL}/admin-applications`);
                if (applicationsResponse.ok) {
                    const applications = await applicationsResponse.json();

                    // Calculate stats from applications
                    const pending = applications.filter(app => app.status === 'PENDING').length;
                    const approved = applications.filter(app => app.status === 'APPROVED').length;
                    const duplicates = applications.filter(app => app.status === 'DUPLICATE').length;

                    document.getElementById('pendingApplications').textContent = pending;
                    document.getElementById('approvedApplications').textContent = approved;
                    document.getElementById('duplicateApplications').textContent = duplicates;

                    // Load recent activities
                    const recentActivities = document.getElementById('recentActivities');
                    recentActivities.innerHTML = '';
                    applications.slice(0, 5).forEach(app => {
                        const activity = app.status === 'PENDING' ? 'New Application' :
                            app.status === 'APPROVED' ? 'Application Approved' :
                                app.status === 'DUPLICATE' ? 'Duplicate Detected' : 'Application Rejected';
                        const action = app.status === 'PENDING' ? 'Review Required' :
                            app.status === 'APPROVED' ? 'Completed' :
                                app.status === 'DUPLICATE' ? 'Action Required' : 'Rejected';
                        const statusClass = `status-${app.status ? app.status.toLowerCase() : 'pending'}`;

                        recentActivities.innerHTML += `
                            <tr>
                                <td>${activity}</td>
                                <td>${app.policy ? app.policy.name : 'N/A'}</td>
                                <td>${app.applicantName || 'N/A'}</td>
                                <td>${app.applicationDate || 'N/A'}</td>
                                <td><span class="status-badge ${statusClass}">${action}</span></td>
                            </tr>
                        `;
                    });
                } else {
                    // Set default values if applications fetch fails
                    document.getElementById('pendingApplications').textContent = '0';
                    document.getElementById('approvedApplications').textContent = '0';
                    document.getElementById('duplicateApplications').textContent = '0';
                }
            } catch (appError) {
                console.warn('Applications data not available:', appError);
                document.getElementById('pendingApplications').textContent = '0';
                document.getElementById('approvedApplications').textContent = '0';
                document.getElementById('duplicateApplications').textContent = '0';
            }

            updateNotificationBadge();

        } catch (error) {
            showAlert(`‚ö†Ô∏è Error loading overview data: ${error.message}`, 'error');
            console.error('Error loading overview data:', error);
        }
    }

    // Load policies - FIXED VERSION
    async function loadPolicies() {
        try {
            showAlert('Loading policies...', 'success');

            const response = await fetch(`${API_BASE_URL}/admin-policies`);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const policies = await response.json();
            const grid = document.getElementById('adminPoliciesGrid');
            grid.innerHTML = '';

            if (policies && policies.length > 0) {
                policies.forEach(policy => addPolicyToGrid(policy));
                showAlert(`‚úÖ Loaded ${policies.length} policies successfully`, 'success');
            } else {
                grid.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1 / -1;">No policies found. Create your first policy!</p>';
            }

        } catch (error) {
            showAlert(`‚ùå Error loading policies: ${error.message}`, 'error');
            console.error('Error loading policies:', error);
        }
    }

    // Add policy to grid - FIXED VERSION
    function addPolicyToGrid(policy) {
        const grid = document.getElementById('adminPoliciesGrid');
        const policyCard = document.createElement('div');
        policyCard.className = 'policy-card';
        policyCard.setAttribute('data-policy-id', policy.id);
        policyCard.innerHTML = `
            <div class="policy-header">
                <div class="policy-icon">${policy.icon || 'üöó'}</div>
                <h3 class="policy-title">${policy.name || 'Unnamed Policy'}</h3>
            </div>
            <p class="policy-description">${policy.description || 'No description available'}</p>
            <div class="policy-benefits">
                <h4>Premium: <span style="color: #4a69bd;">‚Ç®${policy.premiumAmount || 'N/A'}</span></h4>
                <h4>Coverage: <span style="color: #28a745;">‚Ç®${policy.coverageAmount || 'N/A'}</span></h4>
            </div>
            <div class="policy-actions">
                <button class="btn btn-warning" onclick="editPolicy(${policy.id})" style="flex: 1;"> ‚úèÔ∏è Edit </button>
                <button class="btn btn-danger" onclick="deletePolicy(${policy.id})" style="flex: 1;"> üóëÔ∏è Delete </button>
            </div>
        `;
        grid.appendChild(policyCard);
    }

    // Handle create policy form submission - FIXED VERSION
    document.getElementById('createPolicyForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const policyData = {
            name: document.getElementById('policyName').value.trim(),
            icon: document.getElementById('policyIcon').value,
            description: document.getElementById('policyDescription').value.trim(),
            benefits: document.getElementById('policyBenefits').value.split('\n').filter(b => b.trim()),
            premiumAmount: parseFloat(document.getElementById('premiumAmount').value),
            coverageAmount: parseFloat(document.getElementById('coverageAmount').value),
            vehicleType: document.getElementById('policyType').value,
            status: document.getElementById('policyStatus').value
        };

        // Validate data
        if (!policyData.name || !policyData.icon || !policyData.description) {
            showAlert('‚ùå Please fill in all required fields', 'error');
            return;
        }

        try {
            showAlert('Creating policy...', 'success');

            const response = await fetch(`${API_BASE_URL}/admin-policies`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify(policyData)
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`HTTP ${response.status}: ${errorText}`);
            }

            const newPolicy = await response.json();
            addPolicyToGrid(newPolicy);
            showAlert('‚úÖ Policy created successfully!', 'success');
            this.reset();
            await loadOverviewData();

        } catch (error) {
            showAlert(`‚ùå Error creating policy: ${error.message}`, 'error');
            console.error('Error creating policy:', error);
        }
    });

    // Edit policy - FIXED VERSION WITH PROPER ICON HANDLING
    async function editPolicy(policyId) {
        try {
            showAlert('Loading policy for editing...', 'success');

            const response = await fetch(`${API_BASE_URL}/admin-policies/${policyId}`);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: Failed to fetch policy`);
            }

            const policy = await response.json();

            // Populate form with current values - FIXED ICON ISSUE
            document.getElementById('editPolicyId').value = policy.id;
            document.getElementById('editPolicyName').value = policy.name || '';
            document.getElementById('editPolicyIcon').value = policy.icon || ''; // THIS WAS THE MISSING FIX
            document.getElementById('editPolicyDescription').value = policy.description || '';
            document.getElementById('editPolicyBenefits').value = Array.isArray(policy.benefits) ? policy.benefits.join('\n') : '';
            document.getElementById('editPremiumAmount').value = policy.premiumAmount || '';
            document.getElementById('editCoverageAmount').value = policy.coverageAmount || '';
            document.getElementById('editPolicyType').value = policy.vehicleType || '';
            document.getElementById('editPolicyStatus').value = policy.status || 'ACTIVE';

            showModal('editPolicyModal');
            showAlert('‚úèÔ∏è Policy loaded for editing', 'success');

        } catch (error) {
            showAlert(`‚ùå Error loading policy: ${error.message}`, 'error');
            console.error('Error loading policy:', error);
        }
    }

    // Handle edit policy form submission - FIXED VERSION
    document.getElementById('editPolicyForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const policyId = document.getElementById('editPolicyId').value;
        const updatedPolicy = {
            name: document.getElementById('editPolicyName').value.trim(),
            icon: document.getElementById('editPolicyIcon').value, // FIXED ICON UPDATE
            description: document.getElementById('editPolicyDescription').value.trim(),
            benefits: document.getElementById('editPolicyBenefits').value.split('\n').filter(b => b.trim()),
            premiumAmount: parseFloat(document.getElementById('editPremiumAmount').value),
            coverageAmount: parseFloat(document.getElementById('editCoverageAmount').value),
            vehicleType: document.getElementById('editPolicyType').value,
            status: document.getElementById('editPolicyStatus').value
        };

        try {
            showAlert('Updating policy...', 'success');

            const response = await fetch(`${API_BASE_URL}/admin-policies/${policyId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify(updatedPolicy)
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`HTTP ${response.status}: ${errorText}`);
            }

            const policy = await response.json();
            updatePolicyInGrid(policy); // This will update the icon properly
            showAlert(`‚úÖ Policy "${policy.name}" updated successfully!`, 'success');
            closeModal('editPolicyModal');
            this.reset();
            await loadOverviewData();

        } catch (error) {
            showAlert(`‚ùå Error updating policy: ${error.message}`, 'error');
            console.error('Error updating policy:', error);
        }
    });

    // Update policy in grid - FIXED VERSION WITH ICON UPDATE
    function updatePolicyInGrid(policy) {
        const card = document.querySelector(`.policy-card[data-policy-id="${policy.id}"]`);
        if (card) {
            // Update the entire card content including the icon
            card.innerHTML = `
                <div class="policy-header">
                    <div class="policy-icon">${policy.icon || 'üöó'}</div>
                    <h3 class="policy-title">${policy.name}</h3>
                </div>
                <p class="policy-description">${policy.description}</p>
                <div class="policy-benefits">
                    <h4>Premium: <span style="color: #4a69bd;">‚Ç®${policy.premiumAmount || 'N/A'}</span></h4>
                    <h4>Coverage: <span style="color: #28a745;">‚Ç®${policy.coverageAmount || 'N/A'}</span></h4>
                </div>
                <div class="policy-actions">
                    <button class="btn btn-warning" onclick="editPolicy(${policy.id})" style="flex: 1;"> ‚úèÔ∏è Edit </button>
                    <button class="btn btn-danger" onclick="deletePolicy(${policy.id})" style="flex: 1;"> üóëÔ∏è Delete </button>
                </div>
            `;
        }
    }

    // Delete policy - COMPLETELY FIXED VERSION
    async function deletePolicy(policyId) {
        if (confirm('Are you sure you want to delete this policy? This action cannot be undone.')) {
            try {
                showAlert('Deleting policy...', 'success');

                const response = await fetch(`${API_BASE_URL}/admin-policies/${policyId}`, {
                    method: 'DELETE',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                // Remove the policy card from the DOM
                const policyCard = document.querySelector(`.policy-card[data-policy-id="${policyId}"]`);
                if (policyCard) {
                    policyCard.remove();
                }

                showAlert('üóëÔ∏è Policy deleted successfully!', 'success');
                await loadOverviewData(); // Refresh stats

            } catch (error) {
                showAlert(`‚ùå Error deleting policy: ${error.message}`, 'error');
                console.error('Error deleting policy:', error);
            }
        }
    }

    // Load applications - FIXED VERSION
    async function loadApplications() {
        try {
            showAlert('Loading applications...', 'success');

            const response = await fetch(`${API_BASE_URL}/admin-applications`);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: Failed to fetch applications`);
            }

            const applications = await response.json();
            const tableBody = document.getElementById('applicationsTableBody');
            tableBody.innerHTML = '';

            if (applications && applications.length > 0) {
                applications.forEach(app => {
                    const isDuplicate = app.status === 'DUPLICATE';
                    const row = document.createElement('tr');
                    if (isDuplicate) row.style.background = '#fee2e2';

                    row.innerHTML = `
                        <td><input type="checkbox" name="applicationSelect" value="${app.id}"></td>
                        <td>${isDuplicate ? '<span class="duplicate-indicator"></span>' : ''}${app.id}</td>
                        <td>${app.applicantName || 'N/A'}</td>
                        <td>${app.policy ? app.policy.name : 'N/A'}</td>
                        <td>${app.vehicleDetails || 'N/A'}</td>
                        <td>${app.applicationDate || 'N/A'}</td>
                        <td><span class="status-badge status-${app.status ? app.status.toLowerCase() : 'pending'}">${getStatusIcon(app.status)} ${app.status || 'PENDING'}</span></td>
                        <td>
                            <button class="btn btn-success" onclick="viewApplicationDetails(${app.id})" style="padding: 0.3rem 0.6rem; font-size: 0.7rem;">üëÅÔ∏è View</button>
                            ${isDuplicate ?
                        `<button class="btn btn-danger" onclick="deleteDuplicate(${app.id})" style="padding: 0.3rem 0.6rem; font-size: 0.7rem;">üóëÔ∏è Delete</button>` :
                        `<button class="btn btn-success" onclick="approveApplication(${app.id})" style="padding: 0.3rem 0.6rem; font-size: 0.7rem;">‚úÖ</button>
                                 <button class="btn btn-danger" onclick="rejectApplication(${app.id})" style="padding: 0.3rem 0.6rem; font-size: 0.7rem;">‚ùå</button>`}
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
                showAlert(`‚úÖ Loaded ${applications.length} applications`, 'success');
            } else {
                tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #666;">No applications found</td></tr>';
            }

        } catch (error) {
            showAlert(`‚ùå Error loading applications: ${error.message}`, 'error');
            console.error('Error loading applications:', error);
        }
    }

    // View application details - FIXED VERSION
    async function viewApplicationDetails(applicationId) {
        try {
            showAlert('Loading application details...', 'success');

            const response = await fetch(`${API_BASE_URL}/admin-applications/${applicationId}`);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: Failed to fetch application`);
            }

            const app = await response.json();

            const content = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                    <div><strong>Application ID:</strong> ${app.id}</div>
                    <div><strong>Status:</strong> <span class="status-badge status-${app.status ? app.status.toLowerCase() : 'pending'}">${getStatusIcon(app.status)} ${app.status || 'PENDING'}</span></div>
                    <div><strong>Applicant:</strong> ${app.applicantName}</div>
                    <div><strong>Policy:</strong> ${app.policy ? app.policy.name : 'N/A'}</div>
                    <div><strong>Vehicle:</strong> ${app.vehicleDetails || 'N/A'}</div>
                    <div><strong>Date:</strong> ${app.applicationDate || 'N/A'}</div>
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: #4a69bd; margin-bottom: 0.5rem;">Contact Information</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div><strong>Email:</strong> ${app.email || 'N/A'}</div>
                        <div><strong>Phone:</strong> ${app.phone || 'N/A'}</div>
                        <div><strong>NIC:</strong> ${app.nic || 'N/A'}</div>
                        <div><strong>Age:</strong> ${app.age || 'N/A'}</div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <strong>Address:</strong><br> ${app.address || 'N/A'}
                    </div>
                </div>
                ${app.additionalNotes ? `
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="color: #4a69bd; margin-bottom: 0.5rem;">Additional Notes</h4>
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
                            ${app.additionalNotes}
                        </div>
                    </div>` : ''}
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    ${app.status === 'DUPLICATE' ?
                `<button class="btn btn-danger" onclick="deleteDuplicate(${app.id}); closeModal('viewApplicationModal');"> üóëÔ∏è Delete Duplicate </button>` :
                `<button class="btn btn-success" onclick="approveApplication(${app.id}); closeModal('viewApplicationModal');"> ‚úÖ Approve Application </button>
                         <button class="btn btn-danger" onclick="rejectApplication(${app.id}); closeModal('viewApplicationModal');"> ‚ùå Reject Application </button>`}
                </div>
            `;

            document.getElementById('applicationDetailsContent').innerHTML = content;
            showModal('viewApplicationModal');

        } catch (error) {
            showAlert(`‚ùå Error loading application details: ${error.message}`, 'error');
            console.error('Error loading application details:', error);
        }
    }

    // Approve application - FIXED VERSION
    async function approveApplication(applicationId) {
        try {
            showAlert('Approving application...', 'success');

            const response = await fetch(`${API_BASE_URL}/admin-applications/${applicationId}/approve`, {
                method: 'PUT',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`HTTP ${response.status}: ${errorText}`);
            }

            showAlert(`‚úÖ Application ${applicationId} approved successfully!`, 'success');
            await loadApplications();
            await loadOverviewData();

        } catch (error) {
            showAlert(`‚ùå Error approving application: ${error.message}`, 'error');
            console.error('Error approving application:', error);
        }
    }

    // Reject application - FIXED VERSION
    async function rejectApplication(applicationId) {
        if (confirm('Are you sure you want to reject this application?')) {
            try {
                showAlert('Rejecting application...', 'success');

                const response = await fetch(`${API_BASE_URL}/admin-applications/${applicationId}/reject`, {
                    method: 'PUT',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                showAlert(`‚ùå Application ${applicationId} rejected`, 'error');
                await loadApplications();
                await loadOverviewData();

            } catch (error) {
                showAlert(`‚ùå Error rejecting application: ${error.message}`, 'error');
                console.error('Error rejecting application:', error);
            }
        }
    }

    // Delete duplicate application - FIXED VERSION
    async function deleteDuplicate(applicationId) {
        if (confirm('Are you sure you want to delete this duplicate application?')) {
            try {
                showAlert('Deleting duplicate application...', 'success');

                const response = await fetch(`${API_BASE_URL}/admin-applications/${applicationId}`, {
                    method: 'DELETE',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                showAlert(`üóëÔ∏è Duplicate application ${applicationId} deleted`, 'success');
                await loadApplications();
                await loadOverviewData();

            } catch (error) {
                showAlert(`‚ùå Error deleting application: ${error.message}`, 'error');
                console.error('Error deleting application:', error);
            }
        }
    }

    // Toggle select all checkboxes
    function toggleSelectAll() {
        const selectAll = document.getElementById('selectAll');
        const checkboxes = document.querySelectorAll('input[name="applicationSelect"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = selectAll.checked;
        });
    }

    // Approve selected applications
    async function approveSelected() {
        const selected = document.querySelectorAll('input[name="applicationSelect"]:checked');
        if (selected.length === 0) {
            showAlert('‚ö†Ô∏è Please select at least one application to approve.', 'warning');
            return;
        }
        if (confirm(`Are you sure you want to approve ${selected.length} selected application(s)?`)) {
            for (const checkbox of selected) {
                if (checkbox.value) {
                    await approveApplication(checkbox.value);
                }
            }
        }
    }

    // Reject selected applications
    async function rejectSelected() {
        const selected = document.querySelectorAll('input[name="applicationSelect"]:checked');
        if (selected.length === 0) {
            showAlert('‚ö†Ô∏è Please select at least one application to reject.', 'warning');
            return;
        }
        if (confirm(`Are you sure you want to reject ${selected.length} selected application(s)?`)) {
            for (const checkbox of selected) {
                if (checkbox.value) {
                    await rejectApplication(checkbox.value);
                }
            }
        }
    }

    // Update notification badge
    function updateNotificationBadge() {
        const badge = document.getElementById('applicationsBadge');
        if (!badge) return;

        const pending = parseInt(document.getElementById('pendingApplications')?.textContent || '0');
        const duplicates = parseInt(document.getElementById('duplicateApplications')?.textContent || '0');
        const total = pending + duplicates;

        badge.setAttribute('data-count', total);
        badge.classList.toggle('active', total > 0);
    }

    // Refresh applications
    async function refreshApplications() {
        showAlert('üîÑ Refreshing applications data...', 'success');
        await loadApplications();
        await loadOverviewData();
    }

    // Show modal
    function showModal(modalId) {
        document.getElementById(modalId).classList.add('show');
    }

    // Close modal
    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('show');
    }

    // Get status icon
    function getStatusIcon(status) {
        switch(status ? status.toUpperCase() : 'PENDING') {
            case 'PENDING': return '‚è≥';
            case 'APPROVED': return '‚úÖ';
            case 'REJECTED': return '‚ùå';
            case 'DUPLICATE': return '‚ö†Ô∏è';
            default: return '‚è≥';
        }
    }

    // Close modals when clicking outside
    window.addEventListener('click', function(event) {
        if (event.target.classList.contains('modal')) {
            event.target.classList.remove('show');
        }
    });

    console.log('üõ°Ô∏è Admin Panel with ALL FIXES applied successfully!');
</script>
</body>
</html>
